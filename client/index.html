<!DOCTYPE html>
<html ng-app="Desmond">
<head lang="en" ng-controller="MetaController as ctrl">
  <base href="/">
  <meta charset="UTF-8">
  <title ng-bind="ctrl.meta.title">Desmond</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="lib/material-design-iconic-font/css/material-design-iconic-font.min.css" rel="stylesheet"/>
  <link href="lib/fontawesome/css/font-awesome.min.css" rel="stylesheet"/>
  <link href="lib/sweetalert2/dist/sweetalert2.css" rel="stylesheet"/>
  <link href="lib/angular-layout/dist/angular-layout.min.css" rel="stylesheet"/>
  <link href="lib/angular-layout/dist/angular-layout-debug.min.css" rel="stylesheet"/>
  <link href="css/main.css" rel="stylesheet"/>
</head>
<body hbox ng-controller="MainController as ctrl" drag-over-screen>

  <div class="drop-screen">
    <hbox style="width: 100%; height: 100%" align="center">
      <div class="glue"></div>
      <div ng-file-drop ng-repeat="account in ctrl.accounts.bankAccounts" class="drop-box"
          drag-over-class="{accept:'dragover', reject:'dragover-err', delay:100}"
          ng-file-change="ctrl.importFiles(account, $files)"
          multiple="true" allow-dir="false" accept="*.xls,application/pdf">
          <img ng-src="{{account.avatarUrl}}" class="account" width="128" height="128" alt="{{account.description}}"/><br/>
          {{account.name}}
      </div>
      <div class="glue"></div>
    </hbox>
  </div>

  <vbox id="accounts" shrink="0">
    <h2>Patrimonio</h2>
    <span class="total">{{ctrl.movements.all | total | number:2}} €</span>
    <hbox class="account" ng-repeat="account in ctrl.accounts.bankAccounts" color-from-image="background-color" gap="20">
      <img ng-src="{{account.avatarUrl}}" width="64" height="64" alt="{{account.description}}"/>
      <vbox gap="5" justify="center" grow="1">
        <span>{{account.name}}</span>
        <span>{{ctrl.movements.all | filter:{account:account} | total | number:2}} €</span>
      </vbox>
    </hbox>
    <div class="account account-new">
      <i class="md md-3x md-add"></i>
    </div>
  </vbox>

  <vbox grow="1">
    <div id="testChart" shrink="0" style="height: 400px">
      Grafico
    </div>

    <hbox grow="1">
      <vbox grow="1" class="main-box">
        <div class="panel panel-default filters" shrink="0" grow="0">
          <div class="panel-body">
            Conto
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"
                      ng-class="{'btn-primary': ctrl.filters.account}">
                {{ctrl.filters.account ? ctrl.filters.account.name : 'Tutti'}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><a href="" ng-click="ctrl.filters.account = null">Tutti</a></li>
                <li class="divider"></li>
                <li ng-repeat="account in ctrl.accounts.bankAccounts">
                  <a href="" ng-click="ctrl.filters.account = account">{{account.name}}</a>
                </li>
              </ul>
            </div>
            &emsp;
            Origine
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"
                      ng-class="{'btn-primary': ctrl.filters.source}">
                {{ctrl.filters.source ? ctrl.filters.source.name : 'Tutte'}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><a href="" ng-click="ctrl.filters.source = null">Tutte</a></li>
                <li class="divider"></li>
                <li><a href="" ng-click="ctrl.filters.source = {name: 'Sconosciuta'}">Sconosciuta</a></li>
                <li class="divider"></li>
                <li ng-repeat="source in ctrl.sources">
                  <a href="" ng-click="ctrl.filters.source = source">{{source.name}}</a>
                </li>
              </ul>
            </div>
            &emsp;
            Destinazione
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"
                      ng-class="{'btn-primary': ctrl.filters.destination}">
                {{ctrl.filters.destination ? ctrl.filters.destination.name : 'Tutte'}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><a href="" ng-click="ctrl.filters.destination = null">Tutte</a></li>
                <li class="divider"></li>
                <li><a href="" ng-click="ctrl.filters.destination = {name: 'Sconosciuta'}">Sconosciuta</a></li>
                <li class="divider"></li>
                <li ng-repeat="destination in ctrl.destinations">
                  <a href="" ng-click="ctrl.filters.destination = destination">{{destination.name}}</a>
                </li>
              </ul>
            </div>
            &emsp;
            Categoria
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"
                      ng-class="{'btn-primary': ctrl.filters.category}">
                {{ctrl.filters.category ? ctrl.filters.category.name : 'Tutte'}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><a href="" ng-click="ctrl.filters.category = null">Tutte</a></li>
                <li class="divider"></li>
                <li><a href="" ng-click="ctrl.filters.category = {name: 'Non assegnata'}">Non assegnata</a></li>
                <li class="divider"></li>
                <li ng-repeat="category in ctrl.usedCategories">
                  <a href="" ng-click="ctrl.filters.category = category">{{category.name}}</a>
                </li>
              </ul>
            </div>
            &emsp;
            Tipo movimento
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"
                      ng-class="{'btn-primary': ctrl.filters.direction}">
                {{ctrl.filters.direction ? (ctrl.filters.direction === 'in' ? 'Entrate' : 'Uscite') : 'Tutti'}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li><a href="" ng-click="ctrl.filters.direction = null">Tutti</a></li>
                <li class="divider"></li>
                <li><a href="" ng-click="ctrl.filters.direction = 'in'">Entrate</a></li>
                <li><a href="" ng-click="ctrl.filters.direction = 'out'">Uscite</a></li>
              </ul>
            </div>
          </div>
        </div>

        <div shrink="0">
          {{ctrl.filteredMovements.length}} movimenti
        </div>

        <div class="panel panel-selection" ng-show="ctrl.selectedItems.length > 0" ui-scrollfix>
          <div class="panel-body" hbox gap="15">
            <a href ng-click="ctrl.toggleAllSelection()">
              <i class="md md-lg"
                 ng-class="{'md-check': ctrl.selectedItems.length < ctrl.filteredMovements.length, 'md-check-box': ctrl.selectedItems.length == ctrl.filteredMovements.length}"></i>
            </a>
            <span>{{ctrl.selectedItems.length}} Selezionati</span>
            <button class="btn btn-default" ng-disabled="ctrl.selectedItems.length < 2" ng-click="ctrl.mergeSelected()">
              <i class="md md-call-merge md-lg"></i> Unisci
            </button>
            <button class="btn btn-default" ng-click="ctrl.deleteSelected()">
              <i class="md md-delete md-lg"></i> Elimina
            </button>
            <div grow="1" class="text-right">
              <a href ng-click="ctrl.selectedItems = []"><i class="md md-close md-lg"></i></a>
            </div>
          </div>
        </div>

        <desmond-movements-table movements="ctrl.filteredMovements"
                                 selected-items="ctrl.selectedItems"
                                 replace-movement-enabled="true"
                                 on-replace-movement="ctrl.replaceMovement($movement, $file)"
                                 edit-enabled="true"
                                 on-edit="ctrl.editMovement($movement)">
        </desmond-movements-table>
      </vbox>

      <vbox shrink="0" grow="0" class="text-center" style="display: none">
        <strong>Origine patrimonio</strong>
        <div id="incomingBySourceChartContainer">
        </div>
        <hr/>
        <strong>Categorie di spesa</strong>
        <div id="outgoingByCategoryChartContainer">
        </div>
      </vbox>
    </hbox>
  </vbox>

  <script src="lib/color-thief/dist/color-thief.min.js"></script>
  <script src="lib/spark-md5/spark-md5.min.js"></script>
  <script src="lib/chartjs/Chart.js"></script>
  <script src="lib/moment/min/moment-with-locales.min.js"></script>
  <script src="lib/sweetalert2/dist/sweetalert2.min.js"></script>
  <script src="lib/jquery/dist/jquery.min.js"></script>
  <script src="lib/highcharts/highcharts.js"></script>
  <script src="lib/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="lib/lodash/dist/lodash.min.js"></script>
  <script src="lib/pdfjs-bower/dist/pdf.js"></script>
  <script src="lib/js-xls/dist/xls.full.min.js"></script>
  <script src="lib/papaparse.js/papaparse.min.js"></script>
  <script src="lib/angular/angular.min.js"></script>
  <script src="lib/angular-sanitize/angular-sanitize.min.js"></script>
  <script src="lib/angular-ui-utils/ui-utils.min.js"></script>
  <script src="lib/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
  <script src="lib/angular-layout/dist/angular-layout.min.js"></script>
  <script src="lib/ng-file-upload/angular-file-upload.min.js"></script>
  <script src="lib/angular-nl2br/angular-nl2br.min.js"></script>
  <script src="lib/restangular/dist/restangular.min.js"></script>
  <script src="app/lib/autogrow.ng.js"></script>
  <script src="app/component.js"></script>
  <script src="app/model.js"></script>
  <script src="app/service.js"></script>
  <script src="app/rules.js"></script>
  <script src="app/reader.js"></script>
  <script src="app/app.js"></script>
  <script src="app/controller/meta_controller.js"></script>
  <script src="app/controller/main_controller.js"></script>
  <script src="app/controller/import_modal_controller.js"></script>
  <script src="app/controller/edit_modal_controller.js"></script>
</body>
</html>